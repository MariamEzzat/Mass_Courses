<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/js/frontEnd/tasks/logRecord.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/js/frontEnd/tasks/logRecord.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* ============================================log record table ============================================== */
let logRecordTab_pageNumer = 1;
let LogRecord_paginationList_buttons = document.querySelectorAll('#logRecord_paginationList li');

let tasksDataLogRecord = [];

/**
 * get log records list by get function if success (max. 10 record per page)
 * @function loadLogRecordFirstTime 
 */
function loadLogRecordFirstTime() {
    runLoadingAnimation('Loading ... .')
    getTasksIDAndName();
    get(
        IDENTIFIERS.TASKS.TASKS_LOGS_RECORDS.FILTER, {
            pageNumber: logRecordTab_pageNumer,
            pageSize: 10,
        },
        function(data) {
            stopLoadingAnimation();

            fillLogRecordTable(data);
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
        }
    );
};

/**
 * get list of tasks' name and id only
 * @function getTasksIDAndName 
 */
function getTasksIDAndName() {
    runLoadingAnimation('get Data ... .')
    get(
        IDENTIFIERS.TASKS.BASIC, {},
        function(datax) {
            stopLoadingAnimation();
            tasksDataLogRecord = datax

        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
        }
    );
};

/**
 * pagination buttons to show next/previous log records 
 * @event click - pagination log record
 */
LogRecord_paginationList_buttons.forEach(btn => {
    btn.onclick = function(e) {
        e.preventDefault();
        if (e.target.title == 'next') {
            let pageN = parseInt(LogRecord_paginationList_buttons[1].children[0].title) + 1
            LogRecord_paginationList_buttons[1].children[0].title = pageN
            LogRecord_paginationList_buttons[1].children[0].innerHTML = pageN
            logRecordTab_pageNumer = pageN
            GetFilteredDataLogRecord({}, pageN)
        } else if (e.target.title == 'previous' &amp;&amp; parseInt(LogRecord_paginationList_buttons[1].children[0].title) != 1) {
            let pageP = parseInt(LogRecord_paginationList_buttons[1].children[0].title) - 1
            LogRecord_paginationList_buttons[1].children[0].title = pageP
            LogRecord_paginationList_buttons[1].children[0].innerHTML = pageP
            logRecordTab_pageNumer = pageP

            GetFilteredDataLogRecord({}, pageP)
        }
    }
});

/* get data that will  filter depend on it */
/* function getFilterObject() {
    let formData = getIDsAndValuesFormAnyForm('taskList_filter')
    let estimationFilter = {
        future: EstimationInfilterchoiceFuture,
        started: EstimationInfilterchoiceStarted,
        none: EstimationInfilterchoiceNone
    }

    let taskFilterObj;
    if (EstimationInfilterchoiceFuture == undefined &amp;&amp; EstimationInfilterchoiceStarted == undefined &amp;&amp; EstimationInfilterchoiceNone == undefined) {
        taskFilterObj = {
            project: formData.taskList_filter_projects,
            to: formData.taskList_filter_users,
            overdue: checkOverDue
        }
    } else {
        taskFilterObj = {
            project: formData.taskList_filter_projects,
            to: formData.taskList_filter_users,
            estimation: removeEmptiesObjInsideObj(estimationFilter),
            overdue: checkOverDue
        }
    }
    return taskFilterObj
};
 */

/**
 * send filter object to get log record depend on it
 * $ if user request page number 3 or 4 or whatever but no data exist, will show alert that no log records to show
 * @function GetFilteredDataLogRecord 
 * @param {object} filterOptions - represent the object will be sent to server,may contain user's name, project's name... etc
 * @param {number} PageNumber - represent the page number that user request
 */
function GetFilteredDataLogRecord(filterOptions, PageNumber) {

    runLoadingAnimation('Loading ... .')
    get(
        IDENTIFIERS.TASKS.TASKS_LOGS_RECORDS.FILTER, {
            pageNumber: logRecordTab_pageNumer,
            pageSize: 10,
            query: filterOptions
        },
        function(data) {
            LogRecord_paginationList_buttons[1].children[0].title = PageNumber
            LogRecord_paginationList_buttons[1].children[0].innerHTML = PageNumber

            stopLoadingAnimation();
            if (data.length != 0) {
                fillLogRecordTable(data);
            } else {

                document.querySelector('#warningAlertModal_continue').classList.add('d-none')
                warningAlert('No More Log Records', undefined, () => {
                    document.querySelector('#warningAlertModal_continue').classList.remove('d-none')
                    document.querySelector('#warningAlertModal_paragraph').innerHTML = ''
                });

                if ($(window).width() &lt; '890') {
                    document.querySelector(`#allLogsListTable #logsListAll`).innerHTML = `
                        &lt;thead class="text-capitalize font-weight-bold tableHeadYellow">
                            &lt;th>subtask name&lt;/th>
                            &lt;th>&lt;/th>
                            &lt;th>&lt;/th>
                        &lt;/thead>`;
                    if (parseInt(LogRecord_paginationList_buttons[1].children[0].title) != 1) {
                        LogRecord_paginationList_buttons[1].children[0].title = LogRecord_paginationList_buttons[1].children[0].innerHTML = logRecordTab_pageNumer = PageNumber - 1
                        logRecordTab_pageNumer = logRecordTab_pageNumer - 1
                        loadLogRecordFirstTime()
                    } else {
                        LogRecord_paginationList_buttons[1].children[0].title = LogRecord_paginationList_buttons[1].children[0].innerHTML = logRecordTab_pageNumer = 1
                    }
                } else {
                    document.querySelector(`#allLogsListTable #logsListAll`).innerHTML = `
                        &lt;thead class="tableHeadYellow">
                        &lt;tr class="text-center text-capitalize">
                            &lt;th style="width: 15%">date&lt;/th>
                            &lt;th style="width: 10%">subtask&lt;/th>
                            &lt;th style="width: 10%">task&lt;/th>
                            &lt;th style="width: 2%">hours&lt;/th>
                            &lt;th style="width: 2%">percentage&lt;/th>
                            &lt;th style="width: 10%">logger&lt;/th>
                            &lt;th style="width: 5%">location&lt;/th>
                        &lt;/tr>
                    &lt;/thead>`;
                    if (parseInt(LogRecord_paginationList_buttons[1].children[0].title) != 1) {
                        LogRecord_paginationList_buttons[1].children[0].title = LogRecord_paginationList_buttons[1].children[0].innerHTML = logRecordTab_pageNumer = PageNumber - 1
                        logRecordTab_pageNumer = logRecordTab_pageNumer - 1
                        loadLogRecordFirstTime()
                    } else {
                        LogRecord_paginationList_buttons[1].children[0].title = LogRecord_paginationList_buttons[1].children[0].innerHTML = logRecordTab_pageNumer = 1
                    }
                }

            }
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
            modalNewTask.classList.add('d-none');
        }
    );
};

/**
 * fill log record table in two versions (mobile &amp; pc), activate button that view specific task in log record table 
 * active row to be clickable, so when click on task in log record will open task view
 * @function fillLogRecordTable
 * @param {Array} allLogsArr - represent all log records requested (max. 10 record per page)
 */
function fillLogRecordTable(allLogsArr) {
    let logsListAll = document.querySelector(`#allLogsListTable #logsListAll`);

    function getVisualName(userID) {
        var userVisualName;
        for (let user of usersList) {
            if (user.userID == userID) {
                userVisualName = user.visualName;
                break;
            };
        };
        return userVisualName;
    };

    function getTaskName(taskID) {
        var TaskName;
        for (let task of tasksDataLogRecord) {
            if (task._id == taskID) {
                TaskName = task.taskName;
                break;
            };
        };
        return TaskName;
    };

    if ($(window).width() &lt; '890') {
        logsListAll.style.lineHeight = '2'
        let logProgressTableData = `
            &lt;thead class="text-capitalize font-weight-bold tableHeadYellow">
                &lt;th>logger&lt;/th>
                &lt;th>&lt;/th>
                &lt;th>&lt;/th>
            &lt;/thead>`;
        for (let element of allLogsArr) {
            logProgressTableData += `
                &lt;tbody id="logRecords_view_${element.task}">
                    &lt;tr>
                        &lt;td style="width:25%;" class="px-2" rowspan="10">${getVisualName(element.logger)}&lt;/td>  
                    &lt;/tr>
                    &lt;tr>
                        &lt;td class="font-weight-bold" style="width:25%;">subTask &lt;/td>
                        &lt;td>${element.subTask}&lt;/td>
                    &lt;/tr>
                    &lt;tr>
                        &lt;td class="font-weight-bold" style="width:25%;">task &lt;/td>
                        &lt;td>${getTaskName(element.task)}&lt;/td>
                    &lt;/tr>
                    &lt;tr>
                        &lt;td class="font-weight-bold" style="width:25%;">submitted date &lt;/td>
                        &lt;td>${(element.dateSubmitted==undefined)?'':element.dateSubmitted}&lt;/td>
                    &lt;/tr>
                    &lt;tr>
                        &lt;td class="font-weight-bold" style="width:25%;"> submit time &lt;/td>
                        &lt;td>${(new Date(element.date)).toDateString()}, ${(new Date(element.date)).toLocaleTimeString()}&lt;/td>
                    &lt;/tr>
                    
                    &lt;tr>
                        &lt;td class="font-weight-bold" style="width:25%;">hours &lt;/td>
                        &lt;td>${element.hours} Hrs&lt;/td>
                    &lt;/tr>
                    &lt;tr>
                        &lt;td class="font-weight-bold" style="width:25%;"> % &lt;/td>
                        &lt;td>${element.percent}%&lt;/td>
                    &lt;/tr>
                    &lt;tr class="shadow">
                        &lt;td class="font-weight-bold" style="width:25%;"> location &lt;/td>
                        &lt;td>${(element.location==undefined)?'':element.location}&lt;/td>
                    &lt;/tr>
                    
                &lt;/tbody>
                `;
        }
        logsListAll.innerHTML = logProgressTableData;
    } else {
        let logProgressTableData = `
            &lt;thead class="tableHeadYellow">
            &lt;tr class="text-center text-capitalize">
            &lt;th style="width: 15%">submitted date&lt;/th>
                &lt;th style="width: 15%">submit time&lt;/th>
                &lt;th style="width: 10%">subtask&lt;/th>
                &lt;th style="width: 10%">task&lt;/th>
                &lt;th style="width: 2%">hours&lt;/th>
                &lt;th style="width: 2%">percentage&lt;/th>
                &lt;th style="width: 10%">logger&lt;/th>
                &lt;th style="width: 5%">location&lt;/th>
            &lt;/tr>
        &lt;/thead>`;

        for (let element of allLogsArr) {
            logProgressTableData += `
            &lt;tbody class="text-center" id="logRecords_view_${element.task}">
            &lt;tr class="text-capitalize">
                &lt;td>${(element.dateSubmitted==undefined)?'':element.dateSubmitted}&lt;/td>
                &lt;td>${(new Date(element.date)).toDateString()}, ${(new Date(element.date)).toLocaleTimeString()}&lt;/td>
                &lt;td>${element.subTask}&lt;/td>
                &lt;td>${getTaskName(element.task)}&lt;/td>
                &lt;td>${element.hours} Hrs&lt;/td>
                &lt;td>${element.percent}%&lt;/td>
                &lt;td>${getVisualName(element.logger)}&lt;/td>
                &lt;td>${(element.location==undefined)?'':element.location}&lt;/td>
            &lt;/tr>
        &lt;/tbody>`;

        }
        logsListAll.innerHTML = logProgressTableData;
    }

    let taskLogRecordViewButon = document.querySelectorAll('#allLogsListTable #logsListAll [id*="logRecords_view_"]');
    taskLogRecordViewButon.forEach(viewTaskBtn => {
        if (specificTaskModal.querySelector('#taskList_specificTask_taskID').value == '') {

            viewTaskBtn.onclick = function(e) {

                let taskID = e.target.parentElement.parentElement.id.split('_')[2];
                GETspecificTask(taskID)
            };
        } else {

            GETspecificTask(specificTaskModal.querySelector('#taskList_specificTask_taskID').value)

        }
    });
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Document.html">Document</a></li><li><a href="Field.html">Field</a></li><li><a href="Socket.html">Socket</a></li></ul><h3>Events</h3><ul><li><a href="click%2520-%2520selected%2520est.html#.event:infiltertaskslist"> in filter tasks list</a></li><li><a href="global.html#event:change-projectfilterlist">change - project filter list</a></li><li><a href="global.html#event:change-handlingmultiselectfornewtask">change -handling multi select for newtask</a></li><li><a href="global.html#event:change-overdueintaskslist">change -overdue in tasks list</a></li><li><a href="global.html#event:click-ifprojectBasedcategorytasksettingischecked">click -  if projectBased category task setting is checked</a></li><li><a href="global.html#event:click-ifpubliccategorytasksettingischecked">click -  if public category task setting is checked</a></li><li><a href="global.html#event:click-closetaskviewmodal">click - close task view modal</a></li><li><a href="global.html#event:click-ifpublicprojecttasksettingischecked">click - if public project task setting is checked</a></li><li><a href="global.html#event:click-paginationfortaskslist">click - pagination for tasks list</a></li><li><a href="global.html#event:click-paginationlogrecord">click - pagination log record</a></li><li><a href="global.html#event:click-subtasksaddedinnewtaskform">click - subtasks added in new task form</a></li><li><a href="global.html#event:EncryptionResponder">EncryptionResponder</a></li><li><a href="global.html#event:submit-addsubtask">submit - add subtask</a></li><li><a href="global.html#event:submit-submitlogform">submit - submit log form</a></li><li><a href="global.html#event:submit-submittaskafteredit">submit - submit task after edit</a></li><li><a href="global.html#event:submit-sendtasksfilterobj">submit -send tasks filter obj</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addLocationIfNew">addLocationIfNew</a></li><li><a href="global.html#addNewCategory-sentcategoryobjecttothisfunction">addNewCategory - sent category object to this function</a></li><li><a href="global.html#addNewProject-sentprojectobjecttothisfunction">addNewProject - sent project object to this function</a></li><li><a href="global.html#cachedUsers">cachedUsers</a></li><li><a href="global.html#clearNewTaskInputs">clearNewTaskInputs</a></li><li><a href="global.html#clearNewTaskInputs-clearnewtasksinputs">clearNewTaskInputs - clear new tasks inputs</a></li><li><a href="global.html#comments">comments</a></li><li><a href="global.html#dataToSend">dataToSend</a></li><li><a href="global.html#deleteSubTaskS">deleteSubTaskS</a></li><li><a href="global.html#editTask">editTask</a></li><li><a href="global.html#EditTaskModal">EditTaskModal</a></li><li><a href="global.html#fillEditTaskForm">fillEditTaskForm</a></li><li><a href="global.html#fillLogRecordTable">fillLogRecordTable</a></li><li><a href="global.html#fillNewTaskPreData">fillNewTaskPreData</a></li><li><a href="global.html#fillOutputsOfTaskView">fillOutputsOfTaskView</a></li><li><a href="global.html#fillPreData">fillPreData</a></li><li><a href="global.html#fillSubTasksList">fillSubTasksList</a></li><li><a href="global.html#fillTableLogForSubTask">fillTableLogForSubTask</a></li><li><a href="global.html#fillTableOfLogProgress-filltableoflogprogress">fillTableOfLogProgress - fill table of log progress</a></li><li><a href="global.html#fillTaskLogProgressData">fillTaskLogProgressData</a></li><li><a href="global.html#fillTasksListTable">fillTasksListTable</a></li><li><a href="global.html#fillTasksSettingsPreData">fillTasksSettingsPreData</a></li><li><a href="global.html#getCommentsList">getCommentsList</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#GetFilteredData">GetFilteredData</a></li><li><a href="global.html#GetFilteredDataLogRecord">GetFilteredDataLogRecord</a></li><li><a href="global.html#getFilterObject">getFilterObject</a></li><li><a href="global.html#getIDsAndValuesFormAnyForm">getIDsAndValuesFormAnyForm</a></li><li><a href="global.html#getServiceReciever">getServiceReciever</a></li><li><a href="global.html#GETspecificTask">GETspecificTask</a></li><li><a href="global.html#getTasksIDAndName">getTasksIDAndName</a></li><li><a href="global.html#getTasksStatesPreData">getTasksStatesPreData</a></li><li><a href="global.html#getTaskStates">getTaskStates</a></li><li><a href="global.html#getUsers">getUsers</a></li><li><a href="global.html#getUsersIdentifiers">getUsersIdentifiers</a></li><li><a href="global.html#insertComment">insertComment</a></li><li><a href="global.html#insertLogProgress">insertLogProgress</a></li><li><a href="global.html#insertLogRecord">insertLogRecord</a></li><li><a href="global.html#insertNewState">insertNewState</a></li><li><a href="global.html#isValidEnvelope-">isValidEnvelope -</a></li><li><a href="global.html#loadLogRecordFirstTime">loadLogRecordFirstTime</a></li><li><a href="global.html#loadNewTaskData-getpreDataofnewtasktofilllistsinnewtaskform">loadNewTaskData - get preData of new task to fill lists in new task form</a></li><li><a href="global.html#loadTasksFirstTime">loadTasksFirstTime</a></li><li><a href="global.html#missingProperties">missingProperties</a></li><li><a href="global.html#postServiceResponse">postServiceResponse</a></li><li><a href="global.html#preHomeAuth-HOMEPAGESERVING">preHomeAuth -HOME PAGE SERVING</a></li><li><a href="global.html#reciever">reciever</a></li><li><a href="global.html#reciever-services/">reciever - services/</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#respondsCallbacks">respondsCallbacks</a></li><li><a href="global.html#retrieveEditTaskInputs">retrieveEditTaskInputs</a></li><li><a href="global.html#retrieveNewTaskInputs">retrieveNewTaskInputs</a></li><li><a href="global.html#servicesRequests">servicesRequests</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#statesPreData">statesPreData</a></li><li><a href="global.html#submitNewComment">submitNewComment</a></li><li><a href="global.html#submitNewTask-newtaskobjectwillbesenttoit">submitNewTask - new task object will be sent to it</a></li><li><a href="global.html#taskContainsSubtask">taskContainsSubtask</a></li><li><a href="global.html#taskNewState">taskNewState</a></li><li><a href="global.html#tasksLogsRecordsFilter">tasksLogsRecordsFilter</a></li><li><a href="global.html#tasksPreData">tasksPreData</a></li><li><a href="global.html#taskStates">taskStates</a></li><li><a href="global.html#userAssignedTasks">userAssignedTasks</a></li><li><a href="global.html#userTasks">userTasks</a></li><li><a href="global.html#verifyUser">verifyUser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Mar 18 2021 16:55:02 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
