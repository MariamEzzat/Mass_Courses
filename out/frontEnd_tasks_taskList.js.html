<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontEnd/tasks/taskList.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontEnd/tasks/taskList.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let subTasksParentID;
let tasksList_pageNumer = 1;
let taskListObjectsAndUsers;
let allLogsArr = [];
let LogProgress = document.querySelector('#logProgress');
let usersList;
let specificTaskModal = document.querySelector('#taskList_specificTask');
let hasAccessToLogRecord = false;

/**
 * get tasks list by get function if success , will fill table of tasks list (max. 10 record per page),
 *  and check if user has access to see log record table or not 
 * @constructor
 */
function loadTasksFirstTime() {
    let allLogsListTable = document.querySelector('#allLogsListTable');
    runLoadingAnimation('Loading ... .')

    get(
        IDENTIFIERS.TASKS.FILTER, {
            pageNumber: tasksList_pageNumer,
            pageSize: 10,
        },
        function(data) {
            stopLoadingAnimation();
            fillTasksListTable(data);
            usersList = data.users
            taskListObjectsAndUsers = data;
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
        }
    );


    get(
        IDENTIFIERS.TASKS.TASKS_LOGS_RECORDS.ACCESSIBILITY, {},
        function(result) {
            if (result.accessibility.hasAccess === false) {
                allLogsListTable.classList.add('d-none')
            } else {
                allLogsListTable.classList.remove('d-none')
                hasAccessToLogRecord = true
                loadLogRecordFirstTime()
            }
        },
        function(data) {
            console.log(data.errMsg);
        }
    );

};

/**
 * get selected task by get function and if user edited task and remove himself from it so when submit edit will check 
 * if he has access to this task ,if not,will close task view and load tasks list if yes will keep task view opened
 * @constructor
 */
function GETspecificTask(id) {
    runLoadingAnimation('Loading ... .')
    get(
        IDENTIFIERS.TASKS.TASK, {
            taskID: id
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data);
            if (data.taskData.hasAccess == false) {
                document.querySelector('#warningAlertModal_continue').classList.add('d-none')

                warningAlert("You Don't Have Permission To View This Task Anymore", undefined, () => {
                    document.querySelector('#warningAlertModal_continue').classList.remove('d-none')
                    specificTask_close.click();
                })
            } else {
                fillOutputsOfTaskView(data, data.taskData._id);
            }
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
        }
    );
};

/**
 * fill tasks table in two versions (mobile &amp; pc), call get function to fill project &amp; users lists,
 *activate button that view specific task
 * @constructor
 * @param {object} tasksList - represent object that contain users list and tasks list
 */
function fillTasksListTable(tasksList) {
    let taskListTable = document.querySelector('#taskListTable');

    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    var yyyy = today.getFullYear();

    today = `${yyyy}-${mm}-${dd}`

    function getVisualName(userID) {
        var userVisualName;
        for (let user of tasksList.users) {
            if (user.userID == userID) {
                userVisualName = user.visualName;
                break;
            };
        };
        return userVisualName;
    };

    if ($(window).width() &lt; '890') {
        taskListTable.style.lineHeight = '2'
        let taskListTableRow = `
                &lt;thead class="text-capitalize font-weight-bold tableHeadYellow">
                &lt;th>task name&lt;/th>
                &lt;td>&lt;/td>
                &lt;td>&lt;/td>
            &lt;/thead>
         `;


        for (let eachTask of tasksList.tasks) {

            let progress = calculateState(eachTask.taskData.logs, eachTask.taskData.subTasks);
            taskListTableRow +=
                `
            &lt;tbody class="text-capitalize" id="taskList_view_${eachTask._id}">
            &lt;tr class="text-center">
                &lt;td style="width:25%;" rowspan="7">${eachTask.taskData.description.name.trim()}&lt;/td>  
            &lt;/tr>
            &lt;tr>
                &lt;td class="font-weight-bold" style="width:25%;">project &lt;/td>
                &lt;td> ${eachTask.taskData.description.project}&lt;/td>
            &lt;/tr>
            &lt;tr>
                &lt;td class="font-weight-bold" style="width:25%;">deadline &lt;/td>
                &lt;td> ${eachTask.taskData.time.deadline}&lt;/td>
            &lt;/tr>
            &lt;tr>
                &lt;td class="font-weight-bold" style="width:25%;">from &lt;/td>
                &lt;td> ${getVisualName(eachTask.taskData.responsibilities.from)}&lt;/td>
            &lt;/tr>
            &lt;tr>
                &lt;td class="font-weight-bold" style="width:25%;">to&lt;/td>
                &lt;td> ${getVisualName(eachTask.taskData.responsibilities.to)}&lt;/td>
            &lt;/tr>
            &lt;tr>
                &lt;td class="font-weight-bold" style="width:25%;">created by&lt;/td>
                &lt;td> ${getVisualName(eachTask.submitter)}&lt;/td>
            &lt;/tr>
            &lt;tr class="shadow">
                &lt;td class="font-weight-bold" style="width:10%;">progress &lt;/td>
                &lt;td class="py-1"> 
                ${
                    (eachTask.taskData.time.deadline == today &amp;&amp; parseInt(progress.percentage) == 0)?
                    '&lt;div class="alert alert-primary rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    (eachTask.taskData.time.deadline &lt; today &amp;&amp; parseInt(progress.percentage) == 0)?
                        '&lt;div class="alert alert-danger rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    (parseInt(progress.percentage)==100)?
                        '&lt;div class="alert alert-success rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    ((parseInt(progress.percentage) > 0 || parseInt(progress.percentage) &lt; 100) &amp;&amp; eachTask.taskData.time.deadline >= today)?
                        '&lt;div class="alert alert-warning rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    ((parseInt(progress.percentage) > 0 || parseInt(progress.percentage) &lt; 100) &amp;&amp; eachTask.taskData.time.deadline &lt; today)?
                        '&lt;div class="alert alert-danger rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    (parseInt(progress.percentage) == 0 &amp;&amp; eachTask.taskData.time.estimation.start > today)?
                        '&lt;div class="alert alert-dark rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':''
                }&lt;/td>
            &lt;/tr>
        &lt;/tbody>
        `
        };
        //taskListTable.querySelector('tbody').innerHTML = taskListTableRow
        taskListTable.innerHTML = taskListTableRow;
    } else {
        let taskListTableRow = `
        &lt;thead class="tableHeadYellow">
            &lt;tr class="text-center">
                &lt;th style="width: 20%;" class="font-weight-bold text-capitalize" scope="col">name&lt;/th>
                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">project&lt;/th>
                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">deadLine&lt;/th>
                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">from&lt;/th>
                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">to&lt;/th>
                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">estimated time&lt;/th>
                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">created by&lt;/th>
                &lt;th style="width: 15%;" class="font-weight-bold text-capitalize" scope="col">progress&lt;/th>
 
            &lt;/tr>
        &lt;/thead>
        `;

        for (let eachTask of tasksList.tasks) {
            let progress = calculateState(eachTask.taskData.logs, eachTask.taskData.subTasks);

            taskListTableRow +=
                `
            &lt;tbody class="text-center"  id="taskList_view_${eachTask._id}">
            &lt;tr class="text-capitalize">
                &lt;td>${eachTask.taskData.description.name.trim()}&lt;/td>
                &lt;td>${eachTask.taskData.description.project}&lt;/td>
                &lt;td>${eachTask.taskData.time.deadline}&lt;/td>
                &lt;td>${getVisualName(eachTask.taskData.responsibilities.from)}&lt;/td>
                &lt;td>${getVisualName(eachTask.taskData.responsibilities.to)}&lt;/td>
                &lt;td>${eachTask.taskData.time.estimation.amount} hrs&lt;/td>
                &lt;td>${getVisualName(eachTask.submitter)}&lt;/td>
                &lt;td>
                ${
                    (eachTask.taskData.time.deadline == today &amp;&amp; parseInt(progress.percentage) == 0)?
                    '&lt;div class="alert alert-primary rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    (eachTask.taskData.time.deadline &lt; today &amp;&amp; parseInt(progress.percentage) == 0)?
                        '&lt;div class="alert alert-danger rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    (parseInt(progress.percentage)==100)?
                        '&lt;div class="alert alert-success rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    ((parseInt(progress.percentage) > 0 || parseInt(progress.percentage) &lt; 100) &amp;&amp; eachTask.taskData.time.deadline >= today)?
                        '&lt;div class="alert alert-warning rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    ((parseInt(progress.percentage) > 0 || parseInt(progress.percentage) &lt; 100) &amp;&amp; eachTask.taskData.time.deadline &lt; today)?
                        '&lt;div class="alert alert-danger rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':
                    (parseInt(progress.percentage) == 0 &amp;&amp; eachTask.taskData.time.estimation.start > today)?
                        '&lt;div class="alert alert-dark rounded-pill px-1 py-1 m-1">'+progress.show+'&lt;/div>':''
                }
                &lt;/td>
                
            &lt;/tr>
            &lt;/tbody>
            `
        };
        taskListTable.innerHTML = taskListTableRow
    }
    runLoadingAnimation('Loading ... .')
    get(
        IDENTIFIERS.TASKS.NEW_TASK_PRE_DATA, {},
        function(preData) {
            stopLoadingAnimation();
            fillNewTaskPreData(preData);
            if (document.querySelector('#taskList_filter_projects').value == '' &amp;&amp; document.querySelector('#taskList_filter_users').value == '') {
                let elementTaskCategory = '&lt;option>&lt;/option>'
                for (let element of preData.projects) {
                    elementTaskCategory += `&lt;option>${element}&lt;/option>`
                }
                document.querySelector('#taskList_filter_projects').innerHTML = elementTaskCategory;
                $("#taskList_filter_projects").selectpicker('refresh');
                //get task users list
                let elementUser = '&lt;option>&lt;/option>'
                for (let element of preData.users) {
                    elementUser += `&lt;option value='${element.userID}'>${element.visualName}&lt;/option> `
                }
                document.querySelector('#taskList_filter_users').innerHTML = elementUser;
                $("#taskList_filter_users").selectpicker('refresh');
            }
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
            modalNewTask.classList.add('d-none');
        }
    );

    //get all buttons which start by taskList_view_ 
    let taskListViewButon = document.querySelectorAll('[id*="taskList_view_"]');
    taskListViewButon.forEach(viewTaskBtn => {
        if (specificTaskModal.querySelector('#taskList_specificTask_taskID').value == '') {

            viewTaskBtn.onclick = function(e) {
                let taskID = e.target.parentElement.parentElement.id.split('_')[2];
                GETspecificTask(taskID)
            };
        } else {
            GETspecificTask(specificTaskModal.querySelector('#taskList_specificTask_taskID').value)
        }
    });
};

/**
 * fill output data, subtask table And log progress by calling its function and activate edit task button
 * @constructor
 * @param {object} specificTaskDataAndUsers - represent object that contain users list and task data
 * @param {string} taskID - represent viewed task's ID
 */
function fillOutputsOfTaskView(specificTaskDataAndUsers, taskID) {


    function getVisualName(userID) {
        var userVisualName;
        for (let user of specificTaskDataAndUsers.users) {
            if (user.userID == userID) {
                userVisualName = user.visualName;
                break;
            }
        }
        return userVisualName;
    };
    let taskSTATE = calculateState(specificTaskDataAndUsers.taskData.taskData.logs, specificTaskDataAndUsers.taskData.taskData.subTasks).show;
    //calculateSubtasksState(specificTaskDataAndUsers.taskData.taskData.subTasks, specificTaskDataAndUsers.taskData.taskData.logs)

    function getMultipleVisualNames(usersList) {
        let usersString = "";
        for (let user of usersList) {
            usersString += "(" + getVisualName(user) + ")";
        }
        return usersString;
    };
    specificTaskModal.classList.remove('d-none');
    document.querySelector('body').classList.add('overflow-hidden')
    specificTaskModal.querySelector('#taskList_specificTask_taskID').value = taskID;

    fillTableOfLogProgress('taskList_specificTask', specificTaskDataAndUsers.taskData);
    subTasksParentID = "taskList_specificTask";
    fillSubTasksList(specificTaskDataAndUsers.taskData.taskData.subTasks, specificTaskDataAndUsers.taskData);

    EditTaskModal(specificTaskDataAndUsers.taskData, taskID);

    specificTaskModal.querySelector('#specificTask_output_task').innerHTML = specificTaskDataAndUsers.taskData.taskData.description.name.trim()
    specificTaskModal.querySelector('#specificTask_output_notes').innerHTML = specificTaskDataAndUsers.taskData.taskData.description.notes
    specificTaskModal.querySelector('#specificTask_output_category').innerHTML = specificTaskDataAndUsers.taskData.taskData.description.category
    specificTaskModal.querySelector('#specificTask_output_priority').innerHTML = specificTaskDataAndUsers.taskData.taskData.description.priority
    specificTaskModal.querySelector('#specificTask_output_state').innerHTML = taskSTATE
    specificTaskModal.querySelector('#specificTask_output_project').innerHTML = specificTaskDataAndUsers.taskData.taskData.description.project

    specificTaskModal.querySelector('#specificTask_output_deadline').innerHTML = specificTaskDataAndUsers.taskData.taskData.time.deadline
    specificTaskModal.querySelector('#specificTask_output_estimatedTime').innerHTML = specificTaskDataAndUsers.taskData.taskData.time.estimation.amount
    specificTaskModal.querySelector('#specificTask_output_estimatedStart').innerHTML = specificTaskDataAndUsers.taskData.taskData.time.estimation.start
    specificTaskModal.querySelector('#specificTask_output_estimatedEnd').innerHTML = specificTaskDataAndUsers.taskData.taskData.time.estimation.end
    specificTaskModal.querySelector('#specificTask_output_from').innerHTML = getVisualName(specificTaskDataAndUsers.taskData.taskData.responsibilities.from)
    specificTaskModal.querySelector('#specificTask_output_to').innerHTML = getVisualName(specificTaskDataAndUsers.taskData.taskData.responsibilities.to)
    specificTaskModal.querySelector('#specificTask_output_participants').innerHTML = getMultipleVisualNames(specificTaskDataAndUsers.taskData.taskData.responsibilities.participants)
    specificTaskModal.querySelector('#specificTask_output_observers').innerHTML = getMultipleVisualNames(specificTaskDataAndUsers.taskData.taskData.responsibilities.observers)
    specificTaskModal.querySelector('#specificTask_output_auditBy').innerHTML = getVisualName(specificTaskDataAndUsers.taskData.taskData.audition.by)
    specificTaskModal.querySelector('#specificTask_output_auditionNotes').innerHTML = specificTaskDataAndUsers.taskData.taskData.audition.note

};

/**
 * activate button edit to edit submitted task
 * @constructor
 * @param {object} taskDetails - represent  object of saved task
 * @param {string} taskID - represent viewed task's ID
 */
function EditTaskModal(taskDetails, taskID) {
    let editTaskButton = document.querySelector('#taskList_specificTask_edit');
    editTaskButton.onclick = function(e) {
        modalNewTask.classList.remove('d-none');
        document.querySelector('#newTask_button_submit').classList.add('d-none');
        document.querySelector('#newTask_button_edit').classList.remove('d-none');
        modalNewTask.querySelector('.subtasksNewTask').classList.add('d-none');
        fillEditTaskForm(taskDetails, taskID);
    };
};

let specificTask_close = document.querySelector('#taskList_specificTask_close');
// /**
//  * close task view modal , when close modal will load tasks list again to refresh it 
//  * @constructor
//  */
specificTask_close.onclick = function() {
    document.querySelector('body').classList.remove('overflow-hidden')
    specificTaskModal.classList.add('d-none');
    if (hasAccessToLogRecord) {
        loadLogRecordFirstTime()
    };

    loadTasksFirstTime();
    specificTaskModal.querySelector('#taskList_specificTask_taskID').value = ''
};

let taskList_specificTask_addSubTask_close = document.querySelector('#taskList_specificTask_addSubTask_close');
// /**
//  * close form modal which add new subtask in task view
//  * @constructor
//  */
taskList_specificTask_addSubTask_close.onclick = function() {
    document.querySelector('body').classList.remove('overflow-hidden')
    taskList_specificTask_addSubTaskModal.classList.add('d-none')
};

let taskList_specificTask_openModalAddSubTask = document.querySelector('#taskList_specificTask_openModalAddSubTask');
let taskList_specificTask_addSubTaskModal = document.querySelector('#taskList_specificTask_addSubTask');
/**
 * button which open form modal to add subtask  
 * @constructor
 */
taskList_specificTask_openModalAddSubTask.onclick = function(e) {
    e.preventDefault()
    taskList_specificTask_addSubTaskModal.classList.remove('d-none')
};

let taskList_specificTask_addNewSubTask_submit = document.querySelector('#taskList_specificTask_addNewSubTask_submit');
// /**
//  * when click add will get input's subttask data and send it to addSubTask function, close modal subtask 
//  * data - get fields have values entered by user
//  * subTask - represent object that will be sent to server to add subtask
//  * idTask - represent viewed task's ID
//  * addSubTask() - function will receive object of added subtask
//  * @constructor
//  */
taskList_specificTask_addNewSubTask_submit.onclick = function() {
    let data = getIDsAndValuesFormAnyForm('taskList_specificTask_addNewSubTask');
    let idTask = specificTaskModal.querySelector('#taskList_specificTask_taskID').value
    let subTask = {
        taskID: idTask,
        name: data.subtasks_name.trim(),
        hours: data.subtasks_hours,
        type: data.subtasks_type
    };

    document.querySelector('#taskList_specificTask_addNewSubTask').querySelectorAll('input').forEach(inputs => {
        inputs.value = '';
    });
    $("#taskList_specificTask #subtaskTable #subtasks_type").selectpicker('val', '');

    addSubTask(subTask);
    taskList_specificTask_addSubTaskModal.classList.add('d-none')
};

/**
 * fill subtasks array(after calculate each subtask's log hours and percentage) in subtasks list in task view,
 *then activate click on subtask to open collapse modal to view subtask details/delete it/add log for this subtask, activate deleteSbtask function
 * @constructor
 *@param {Array} subTasks - array of subtasks for specific task viewed by user
 *@param {object} taskData - object of specific task viewed by user
 */
function fillSubTasksList(subTasks, taskData) {
    let subtaskTable = document.querySelector(`#accordionSubtasks`)

    let subtaskTableRow = ``;
    let subTaskCalculated = calculateSubtasksState(subTasks, taskData.taskData.logs)
    for (let i = 0; i &lt; subTaskCalculated.length; i++) {

        subtaskTableRow += `
                &lt;div class="font-weight-bold  text-capitalize py-1" data-toggle="collapse" data-target="#subtask_${i}" aria-expanded="true" aria-controls="${subTaskCalculated[i].name.trim()}">
                        &lt;span class="">&amp;#8226; ${subTaskCalculated[i].name.trim()} &lt;/span>
                        &lt;div class="progress ${($(window).width() > '890')?"w-50":"w-75"}">
                            &lt;div class="progress-bar progress-bar-striped progress-bar-animated bg-warning text-dark " 
                            role="progressbar" aria-valuenow="${subTaskCalculated[i].percentage}" aria-valuemin="0" aria-valuemax="100" 
                            style="width: ${subTaskCalculated[i].percentage}%">
                            ${subTaskCalculated[i].type}, ${subTaskCalculated[i].logHours}Hrs, ${subTaskCalculated[i].percentage}%
                        &lt;/div>
                    &lt;/div>
                &lt;/div>

                &lt;div id="subtask_${i}" class="collapse p-0 shadow rounded w-100 border" data-parent="#accordionSubtasks">
                    &lt;div id="specificTask_tabsOfsubtasks" class="${($(window).width() &lt; '890')?"d-none":""}">
                        &lt;ul class="nav nav-tabs">
                            &lt;li class="nav-item">
                                &lt;a class="nav-link active text-capitalize" id="Task_viewSubtask-tab" href="#" task-Subtasks-tab-target="#Task_viewSubtask">
                                    &lt;i class="fas fa-eye"> view&lt;/i>
                                &lt;/a>
                            &lt;/li>
                            &lt;!--&lt;li class="nav-item">
                                &lt;a class="nav-link text-capitalize" id="Task_checkList-tab" href="#" task-Subtasks-tab-target="#Task_checkList">
                                    &lt;i class="fas fa-tasks"> checkList&lt;/i>&lt;/a>
                            &lt;/li>-->
                            &lt;li class="nav-item">
                                &lt;a class="nav-link text-capitalize" href="#" title="${subTaskCalculated[i].name.trim()}">
                                    &lt;i class="far fa-times-circle text-danger deleteSubtask"> Delete&lt;/i>
                                &lt;/a>
                            &lt;/li>
                        &lt;/ul>
                    &lt;/div>
                    &lt;div id="specificTask_dropDownSubtasksTabs" class="${($(window).width() > '890')?"d-none":""} border-bottom py-1">
                        &lt;div class="dropdown">
                        
                            &lt;a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="specificTask_dropDownSubtasksTabsList" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Select Tab 
                            &lt;/a>
                            &lt;div class="dropdown-menu" aria-labelledby="specificTask_dropDownSubtasksTabsList">
                                &lt;a class="nav-link active text-capitalize" id="Task_viewSubtask-tab" href="#" task-Subtasks-tab-target="#Task_viewSubtask">
                                    &lt;i class="fas fa-eye"> view&lt;/i>
                                &lt;/a>
                                &lt;!--&lt;a class="nav-link text-capitalize" id="Task_checkList-tab" href="#" task-Subtasks-tab-target="#Task_checkList">
                                    &lt;i class="fas fa-tasks"> checkList&lt;/i>&lt;/a>-->
                                &lt;a class="nav-link text-capitalize" href="#" title="${subTaskCalculated[i].name.trim()}">
                                    &lt;i class="far fa-times-circle text-danger deleteSubtask"> Delete&lt;/i>
                                &lt;/a>
                            &lt;/div>
                        &lt;/div>
                    &lt;/div>

                    &lt;div class="px-1 px-md-3">
                        &lt;div id="Task_viewSubtask" task-Subtasks-tab-content>
                            &lt;div class="d-flex justify-content-end p-0">
                                &lt;a class="nav-link text-capitalize p-0" href="#">
                                    &lt;i class="fas fa-plus-circle" id="subTasks_${subTaskCalculated[i].name.trim()}_${specificTaskModal.querySelector('#taskList_specificTask_taskID ').value}_${subTaskCalculated[i].percentage}"> 
                                        Add Log
                                    &lt;/i>
                                &lt;/a>
                            &lt;/div>
                            &lt;ul class="px-4">
                                &lt;li class="py-1">&lt;span class="font-weight-bold text-capitalize">name:&lt;/span> ${subTaskCalculated[i].name}&lt;/li>
                                &lt;li class="py-1">&lt;span class="font-weight-bold text-capitalize">est. time:&lt;/span> ${subTaskCalculated[i].hours}&lt;/li>
                                &lt;li class="py-1">&lt;span class="font-weight-bold text-capitalize">type:&lt;/span> ${subTaskCalculated[i].type}&lt;/li>
                                &lt;li class="py-1">&lt;span class="font-weight-bold text-capitalize">log hrs:&lt;/span> ${subTaskCalculated[i].logHours}&lt;/li>
                                &lt;li class="py-1">&lt;span class="font-weight-bold text-capitalize">%:&lt;/span> ${subTaskCalculated[i].percentage}&lt;/li>
                            &lt;/ul>
                        &lt;/div>

                        &lt;div id="Task_checkList" class="d-none" task-Subtasks-tab-content>
                            sdg
                        &lt;/div>
                    &lt;/div>
                &lt;/div>
                    `;
    };
    subtaskTable.innerHTML = subtaskTableRow;
    let subtaskListLogButon = document.querySelectorAll('[id*="subTasks_"]');
    subtaskListLogButon.forEach(subtaskLogButon => {
        subtaskLogButon.onclick = function(e) {
            LogProgress.classList.remove('d-none');
            fillTaskLogProgressData(taskData)
            document.querySelector('#logProgressForm_subtaskState').innerHTML = `Progress: ${e.target.id.split('_')[3]}%`
            document.querySelector('#logProgressForm_subtaskState').setAttribute("data-subtaskState", e.target.id.split('_')[3])
            $("#logProgress_select_subtask").selectpicker('val', e.target.id.split('_')[1])
        };
    });

    /* let subtask_checkList = document.querySelectorAll('[id*="subtask_checkList_"]');
    subtask_checkList.forEach(viewTaskBtn => {
        console.log(viewTaskBtn);
        viewTaskBtn.onclick = function(e) {

        };
    }); */
    deleteSubTaskS();
};

// /**
//  * button to close form of log progress
//  * @constructor
//  */
document.querySelector('#logProgress_close').onclick = function(e) {
    LogProgress.classList.add('d-none');
    subtaskValueInLogProgressSelect = '';
};

/**
 * function that delete subtask after get object of subtask name and task id to send this object to removeSubtask function
 * @constructor
 */
function deleteSubTaskS() {
    //when click add will get subttask name, taskID and send it to removeSubTask function
    let deleteSubTaskInViewSpecificTask = document.querySelectorAll('#taskList_specificTask #accordionSubtasks .deleteSubtask')
    deleteSubTaskInViewSpecificTask.forEach(deleteSubTask => {
        let removedSubTask = {};

        deleteSubTask.onclick = function(e) {
            //stop clickable row to click when click delete subTask
            document.querySelector('#warningAlertModal_close').innerHTML = "cancel"
            warningAlert(`Are Sure you want to delete '${e.target.parentElement.title.trim()}' ?`, () => {
                document.querySelector('#warningAlertModal_close').innerHTML = "close"
                let subTaskName = e.target.parentElement.title.trim();
                e.stopPropagation();

                let IDofTask = specificTaskModal.querySelector('#taskList_specificTask_taskID').value
                removedSubTask = {
                    taskID: IDofTask,
                    name: subTaskName.trim()
                };
                removeSubTask(removedSubTask);

                taskList_specificTask_addSubTaskModal.classList.add('d-none')

            }, () => {
                document.querySelector('#warningAlertModal_close').innerHTML = "close"
            })
        };
    });
};

/**
 *  edit task by filling modal new task with pre saved task data so user can see thier entered data and edit it
 * @constructor
 * @param {object} taskEditData - represent details for requested task to edit
 * @param {string} taskID - represent viewed task's ID
 */
function fillEditTaskForm(taskEditData, taskID) {

    runLoadingAnimation('Loading ... .')
    get(
        IDENTIFIERS.TASKS.NEW_TASK_PRE_DATA, {},
        function(preData) {
            stopLoadingAnimation();
            fillNewTaskPreData(preData);
            document.querySelector('#newTaskForm_hidden_taskID').value = taskID
            $("#newTask_input_name").val(taskEditData.taskData.description.name)
            $("#newTask_input_notes").val(taskEditData.taskData.description.notes)
            $("#newTask_input_dueDate").val(taskEditData.taskData.time.deadline)
            $("#newTask_input_estimatedTime").val(taskEditData.taskData.time.estimation.amount)
            $("#newTask_input_estimatedTimeStart").val(taskEditData.taskData.time.estimation.start)
            $("#newTask_input_estimatedTimeEnd").val(taskEditData.taskData.time.estimation.end)
            $("#newTask_input_auditionNotes").val(taskEditData.taskData.audition.note)

            $("#newTask_input_taskCategory").selectpicker('val', taskEditData.taskData.description.category);
            $("#newTask_input_taskProject").selectpicker('val', taskEditData.taskData.description.project);
            $("#newTask_input_assignedFrom").selectpicker('val', taskEditData.taskData.responsibilities.from);
            $("#newTask_input_assignedTo").selectpicker('val', taskEditData.taskData.responsibilities.to);
            $("#newTask_input_participants").selectpicker('val', taskEditData.taskData.responsibilities.participants);
            $("#newTask_input_observers").selectpicker('val', taskEditData.taskData.responsibilities.observers);
            $("#newTask_input_auditedBy").selectpicker('val', taskEditData.taskData.audition.by);
            $("#newTask_input_taskPriority").selectpicker('val', taskEditData.taskData.description.priority);
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
            modalNewTask.classList.add('d-none');
        }
    );
};

/**
 * Represents a task after edit.
 * @param {object} dataObj - get fields have values entered by user
 * @param {object} taskObject - task object that will be sent to server after edit
 */
function retrieveEditTaskInputs() {
    let dataObj = getIDsAndValuesFormAnyForm('newTask_form')
    taskObject = {
        taskID: dataObj.newTaskForm_hidden_taskID,
        taskData: {
            description: {
                name: dataObj.newTask_input_name.trim(),
                notes: dataObj.newTask_input_notes,
                category: dataObj.newTask_input_taskCategory,
                priority: dataObj.newTask_input_taskPriority,
                project: dataObj.newTask_input_taskProject,
            },
            time: {
                deadline: dataObj.newTask_input_dueDate,
                estimation: {
                    amount: dataObj.newTask_input_estimatedTime,
                    start: dataObj.newTask_input_estimatedTimeStart,
                    end: dataObj.newTask_input_estimatedTimeEnd
                }
            },
            responsibilities: {
                from: dataObj.newTask_input_assignedFrom,
                to: dataObj.newTask_input_assignedTo,
                participants: cleanArray($('#newTask_input_participants').val()),
                observers: cleanArray($('#newTask_input_observers').val())
            },
            audition: {
                by: dataObj.newTask_input_auditedBy,
                note: dataObj.newTask_input_auditionNotes
            },
        }
    };

    return taskObject
};

let newTask_button_edit_submit = document.querySelector('#newTask_button_edit');
// /**
//  * button which send edited data of task by calling post function by post function
//  * @constructor
//  */
newTask_button_edit_submit.onclick = function(e) {
    e.preventDefault()
    let obj = retrieveEditTaskInputs();
    runLoadingAnimation('Loading ... .')
    post(
        IDENTIFIERS.TASKS.EDIT_TASK,
        obj,
        function() {
            stopLoadingAnimation();
            notifyResult(true, 'Saved Successfully', () => {
                clearNewTaskInputs();
                document.querySelector('#newTask_button_edit').classList.add('d-none');
                modalNewTask.classList.add('d-none');
                GETspecificTask(specificTaskModal.querySelector('#taskList_specificTask_taskID').value)
            });

        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);

            if (LABELS.INVALID_INPUTS.INVALID_INPUTS_STATUS === data.status) {
                notifyResult(false, data.userMsg);
            } else {
                notifyResult(false, data.userMsg);
                modalNewTask.classList.add('d-none');
            }
        }
    );
};

let taskList_paginationList_buttons = document.querySelectorAll('#taskList_paginationList li');
// /**
//  * pagination buttons to show next/previous tasks list (max. 10 tasks in each page) 
//  * @constructor
//  */
taskList_paginationList_buttons.forEach(btn => {
    btn.onclick = function(e) {
        e.preventDefault();
        if (e.target.title == 'next') {
            let pageN = parseInt(taskList_paginationList_buttons[1].children[0].title) + 1
            taskList_paginationList_buttons[1].children[0].title = pageN
            taskList_paginationList_buttons[1].children[0].innerHTML = pageN
            tasksList_pageNumer = pageN
            let filterOptions = removeEmptiesObjInsideObj(getFilterObject());
            GetFilteredData(filterOptions, tasksList_pageNumer)


        } else if (e.target.title == 'previous' &amp;&amp; parseInt(taskList_paginationList_buttons[1].children[0].title) != 1) {
            let pageP = parseInt(taskList_paginationList_buttons[1].children[0].title) - 1
            taskList_paginationList_buttons[1].children[0].title = pageP
            taskList_paginationList_buttons[1].children[0].innerHTML = pageP
            tasksList_pageNumer = pageP
            let filterOptions = removeEmptiesObjInsideObj(getFilterObject());
            GetFilteredData(filterOptions, tasksList_pageNumer)


        }
    }
});
/* ====================================filter tasks ========================= */

let taskList_filter_projects;
/**
 *selected project in filter tasks
 * @constructor
 */
/* $('#taskList_filter_projects').change(function(e) {
    var selected = $(e.target).val();
    taskList_filter_projects = selected;
    let selectedOption = $('#taskList_filter_projects').find('option:selected');
    e.target.parentNode.nextElementSibling.innerHTML = ''
    for (let sel of selectedOption) {
        e.target.parentNode.nextElementSibling.innerHTML += ` (${sel.innerHTML}) `
    }
    document.querySelector('#taskList_filter_submit').click()
});

let taskList_filter_users;
$('#taskList_filter_users').change(function(e) {
    var selected = $(e.target).val();
    taskList_filter_users = selected;
    let selectedOption = $('#taskList_filter_users').find('option:selected');
    e.target.parentNode.nextElementSibling.innerHTML = ''
    for (let sel of selectedOption) {
        e.target.parentNode.nextElementSibling.innerHTML += ` (${sel.innerHTML}) `
    }
    document.querySelector('#taskList_filter_submit').click()
}); */

let filterEstimation = document.querySelectorAll('input[name="taskList_filter_estimation"]')
let EstimationInfilterchoiceFuture, EstimationInfilterchoiceStarted, EstimationInfilterchoiceNone;
// /** 
//  *selected estimation in filter tasks
//  * @constructor
//  */
filterEstimation.forEach(radioBtn => {
    radioBtn.onclick = (e) => {
        e.target = true;
        if (e.target.id.split('_')[3] == 'future') {
            EstimationInfilterchoiceFuture = 1;
            EstimationInfilterchoiceStarted = undefined;
            EstimationInfilterchoiceNone = undefined;
        } else if (e.target.id.split('_')[3] == 'started') {
            EstimationInfilterchoiceFuture = undefined;
            EstimationInfilterchoiceStarted = 1;
            EstimationInfilterchoiceNone = undefined;
        } else {
            EstimationInfilterchoiceFuture = undefined;
            EstimationInfilterchoiceStarted = undefined;
            EstimationInfilterchoiceNone = undefined;
        }
        //document.querySelector('#taskList_filter_submit').click()
    }
});

let taskList_filter_overdue = document.querySelector('input[id="taskList_filter_overdue"]')
let checkOverDue;
/** 
 * checked or not overdue in filter tasks
 * @constructor
 */
taskList_filter_overdue.addEventListener('change', (e) => {
    if (e.target.checked == true) {
        checkOverDue = 1
    } else {
        checkOverDue = ''
    }
    //document.querySelector('#taskList_filter_submit').click()
});

/** 
 * get data that will  filter depend on it
 * @constructor
 */
function getFilterObject() {
    let formData = getIDsAndValuesFormAnyForm('taskList_filter')
    let estimationFilter = {
        future: EstimationInfilterchoiceFuture,
        started: EstimationInfilterchoiceStarted,
        none: EstimationInfilterchoiceNone
    }

    let taskFilterObj;
    if (EstimationInfilterchoiceFuture == undefined &amp;&amp; EstimationInfilterchoiceStarted == undefined &amp;&amp; EstimationInfilterchoiceNone == undefined) {
        taskFilterObj = {
            project: formData.taskList_filter_projects,
            to: formData.taskList_filter_users,
            overdue: checkOverDue
        }
    } else {
        taskFilterObj = {
            project: formData.taskList_filter_projects,
            to: formData.taskList_filter_users,
            estimation: removeEmptiesObjInsideObj(estimationFilter),
            overdue: checkOverDue
        }
    }
    return taskFilterObj
};

/*  */
/**
 * get tasks list upon filter form filled by user ,
 * if response with empty object then user can't to go next page because there's no data to show
 * @constructor
 * @param {object} filterOptions - represent the object will be sent to server, contain user's name, project's name, estimation and if it overdue or not
 * @param {number} PageNumber - represent the page number that user request
 */
function GetFilteredData(filterOptions, PageNumber) {
    runLoadingAnimation('Loading ... .')
    get(
        IDENTIFIERS.TASKS.FILTER, {
            pageNumber: tasksList_pageNumer,
            pageSize: 10,
            query: filterOptions
        },
        function(data) {
            taskList_paginationList_buttons[1].children[0].title = PageNumber
            taskList_paginationList_buttons[1].children[0].innerHTML = PageNumber
            usersList = data.users
            stopLoadingAnimation();
            if (data.tasks.length != 0) {
                fillTasksListTable(data);
            } else {

                document.querySelector('#warningAlertModal_continue').classList.add('d-none')
                warningAlert('No More Tasks', undefined, () => {
                    document.querySelector('#warningAlertModal_continue').classList.remove('d-none')
                    document.querySelector('#warningAlertModal_paragraph').innerHTML = ''
                });

                if ($(window).width() &lt; '890') {
                    document.querySelector('#taskListTable').innerHTML = `
                                &lt;thead class="text-capitalize font-weight-bold tableHeadYellow">
                                &lt;th>task name&lt;/th>
                                &lt;td>&lt;/td>
                                &lt;td>&lt;/td>
                            &lt;/thead>
                         `;
                    if (parseInt(taskList_paginationList_buttons[1].children[0].title) != 1) {
                        taskList_paginationList_buttons[1].children[0].title = taskList_paginationList_buttons[1].children[0].innerHTML = tasksList_pageNumer = PageNumber - 1
                        let filterOptions = removeEmptiesObjInsideObj(getFilterObject());
                        GetFilteredData(filterOptions, PageNumber - 1)
                    } else {
                        taskList_paginationList_buttons[1].children[0].title = taskList_paginationList_buttons[1].children[0].innerHTML = tasksList_pageNumer = 1

                    }
                } else {
                    document.querySelector('#taskListTable').innerHTML = `
                        &lt;thead class="tableHeadYellow">
                            &lt;tr class="text-center">
                                &lt;th style="width: 20%;" class="font-weight-bold text-capitalize" scope="col">name&lt;/th>
                                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">project&lt;/th>
                                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">deadLine&lt;/th>
                                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">from&lt;/th>
                                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">to&lt;/th>
                                &lt;th style="width: 10%;" class="font-weight-bold text-capitalize" scope="col">estimated time&lt;/th>
                                &lt;th style="width: 15%;" class="font-weight-bold text-capitalize" scope="col">progress&lt;/th>
                 
                            &lt;/tr>
                        &lt;/thead>
                        `;
                    if (parseInt(taskList_paginationList_buttons[1].children[0].title) != 1) {
                        taskList_paginationList_buttons[1].children[0].title = taskList_paginationList_buttons[1].children[0].innerHTML = tasksList_pageNumer = PageNumber - 1
                        let filterOptions = removeEmptiesObjInsideObj(getFilterObject());
                        GetFilteredData(filterOptions, PageNumber - 1)
                    } else {
                        taskList_paginationList_buttons[1].children[0].title = taskList_paginationList_buttons[1].children[0].innerHTML = tasksList_pageNumer = 1

                    }
                }
            };
        },
        function(data) {
            stopLoadingAnimation();
            console.log(data.errMsg);
            notifyResult(false, data.userMsg);
            modalNewTask.classList.add('d-none');
        }
    );
};

/*  */
let taskList_filter_submit = document.querySelector('#taskList_filter_submit');
// /** 
//  * button which send data to server to get filtered tasks
//  * @constructor
//  */
taskList_filter_submit.onclick = function(e) {
    e.preventDefault();
    let filterOptions = removeEmptiesObjInsideObj(getFilterObject());

    tasksList_pageNumer = 1
    GetFilteredData(filterOptions, tasksList_pageNumer)
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="clearNewTaskInputs.html">clearNewTaskInputs</a></li><li><a href="clearTaskLogProgressInputs.html">clearTaskLogProgressInputs</a></li><li><a href="deleteSubTaskS.html">deleteSubTaskS</a></li><li><a href="EditTaskModal.html">EditTaskModal</a></li><li><a href="fillEditTaskForm.html">fillEditTaskForm</a></li><li><a href="fillLogRecordTable.html">fillLogRecordTable</a></li><li><a href="fillNewTaskPreData.html">fillNewTaskPreData</a></li><li><a href="fillOutputsOfTaskView.html">fillOutputsOfTaskView</a></li><li><a href="fillSubTasksList.html">fillSubTasksList</a></li><li><a href="fillTasksListTable.html">fillTasksListTable</a></li><li><a href="fillTasksSettingsPreData.html">fillTasksSettingsPreData</a></li><li><a href="GetFilteredData.html">GetFilteredData</a></li><li><a href="GetFilteredDataLogRecord.html">GetFilteredDataLogRecord</a></li><li><a href="getFilterObject.html">getFilterObject</a></li><li><a href="GETspecificTask.html">GETspecificTask</a></li><li><a href="getTasksIDAndName.html">getTasksIDAndName</a></li><li><a href="loadLogRecordFirstTime.html">loadLogRecordFirstTime</a></li><li><a href="loadTasksFirstTime.html">loadTasksFirstTime</a></li><li><a href="retrieveNewTaskInputs.html">retrieveNewTaskInputs</a></li><li><a href="taskList_specificTask_openModalAddSubTask.onclick.html">onclick</a></li></ul><h3>Global</h3><ul><li><a href="global.html#fillTaskLogProgressData">fillTaskLogProgressData</a></li><li><a href="global.html#retrieveEditTaskInputs">retrieveEditTaskInputs</a></li><li><a href="global.html#retrieveTaskLogProgressInputs">retrieveTaskLogProgressInputs</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Feb 25 2021 16:57:54 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
