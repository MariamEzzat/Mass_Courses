<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontEnd/tasks/newTask.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontEnd/tasks/newTask.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//console.log('new task here');
let newTaskOpenButton = document.querySelector('#newTask_openButton');
let modalNewTask = document.querySelector('#newTask');
let subTaskArr = [];

newTaskOpenButton.onclick = function(e) {
    modalNewTask.classList.remove('d-none');
    document.querySelector('body').classList.add('overflow-hidden');
    document.querySelector('#newTask_button_submit').classList.remove('d-none');
    document.querySelector('#newTask_button_edit').classList.add('d-none');
    modalNewTask.querySelector('.subtasksNewTask').classList.remove('d-none');
    loadNewTaskData();
};

/* close modal new task will hide button edit and submit */
let newTask_Close = document.querySelector('#newTask_close');
newTask_Close.onclick = function() {
    loadTasksFirstTime();
    document.querySelector('body').classList.remove('overflow-hidden');
    document.querySelector('#newTask_button_submit').classList.add('d-none');
    document.querySelector('#newTask_button_edit').classList.add('d-none');
    modalNewTask.classList.add('d-none');
    clearNewTaskInputs();
};
/* ===============****submit new task form****================== */
let newTask_button_submit = document.querySelector('#newTask_button_submit')
newTask_button_submit.onclick = function(e) {
    e.preventDefault();
    submitNewTask();
    if (document.querySelector('#newTask_button_submit').classList.contains('d-none')) {
        loadTasksFirstTime()
    }
};

/* handling multi select for newtask */
let newTask_input_participants;
$('#newTask_input_participants').change(function(e) {
    var selected = $(e.target).val();
    newTask_input_participants = cleanArray(selected)
    let selectedOption = $('#newTask_input_participants').find('option:selected');
    e.target.parentNode.nextElementSibling.innerHTML = ''
    for (let sel of selectedOption) {
        e.target.parentNode.nextElementSibling.innerHTML += ` (${sel.innerHTML}) `
    }
});

let newTask_input_observers;
$('#newTask_input_observers').change(function(e) {
    var selected = $(e.target).val();
    newTask_input_observers = cleanArray(selected);
    let selectedOption = $('#newTask_input_observers').find('option:selected');
    e.target.parentNode.nextElementSibling.innerHTML = ''
    for (let sel of selectedOption) {
        e.target.parentNode.nextElementSibling.innerHTML += ` (${sel.innerHTML}) `
    }
});

let newTask_input_attachment;
/* document.querySelector('#newTask_input_attachment').onchange= function(e) {
    newTask_input_attachment = e.target.files;
}; */

/**
 * Represents a new task.
 * @constructor
 * @param {object} dataObj - get fields have values entered by user
 * @param {object} taskObject - task object that will be sent to server after edit
 */
function retrieveNewTaskInputs() {
    let dataObj = getIDsAndValuesFormAnyForm('newTask_form')
    taskObject = {
        name: dataObj.newTask_input_name.trim(),
        notes: dataObj.newTask_input_notes,
        category: dataObj.newTask_input_taskCategory,
        priority: dataObj.newTask_input_taskPriority,
        project: dataObj.newTask_input_taskProject,
        state: dataObj.newTask_input_taskState,
        timePlanning: {
            deadline: dataObj.newTask_input_dueDate,
            estimatedTime: {
                hours: dataObj.newTask_input_estimatedTime,
                startDate: dataObj.newTask_input_estimatedTimeStart,
                endDate: dataObj.newTask_input_estimatedTimeEnd
            }
        },
        responsibilities: {
            assignedFrom: dataObj.newTask_input_assignedFrom,
            assignedTo: dataObj.newTask_input_assignedTo,
            participants: newTask_input_participants,
            observers: newTask_input_observers
        },
        audition: {
            auditedBy: dataObj.newTask_input_auditedBy,
            auditionNotes: dataObj.newTask_input_auditionNotes
        },
        attachments: newTask_input_attachment,
        subTasks: subTaskArr
    };
    return taskObject
};
/* document.querySelector('#newTask_form').onsubmit = function(e) {
    e.preventDefault()
    let h = retrieveNewTaskInputs()
    console.log(h);
} */

/**
 * get lists from server to put it in new task form select tags
 * @constructor
 * @param {object} preData - get data of lists in new task form
 */
function fillNewTaskPreData(preData) {
    //get task category list
    let elementTaskCategory = '&lt;option>&lt;/option>'
    for (let element of preData.categories) {
        elementTaskCategory += `&lt;option>${element}&lt;/option>`
    }
    document.querySelector('#newTask_input_taskCategory').innerHTML = elementTaskCategory;
    $("#newTask_input_taskCategory").selectpicker('refresh');

    //get projects list
    let elementTaskProject = '&lt;option>&lt;/option>'
    for (let element of preData.projects) {
        elementTaskProject += `&lt;option>${element}&lt;/option>`
    }
    document.querySelector('#newTask_input_taskProject').innerHTML = elementTaskProject;
    $("#newTask_input_taskProject").selectpicker('refresh');
    /*
        //get task state list
        let elementTaskState = '&lt;option>&lt;/option>'
        for (let element of preData.states) {
            elementTaskState += `&lt;option>${element}&lt;/option>`
        }
        document.querySelector('#newTask_input_taskState').innerHTML = elementTaskState;
        $("#newTask_input_taskState").selectpicker('refresh');*/

    //get users list
    let elementUser = '&lt;option>&lt;/option>'
    for (let element of preData.users) {
        elementUser += `&lt;option value='${element.userID}'>${element.visualName}&lt;/option> `
    }
    document.querySelector('#newTask_input_assignedFrom').innerHTML = elementUser;
    document.querySelector('#newTask_input_assignedTo').innerHTML = elementUser;
    document.querySelector('#newTask_input_participants').innerHTML = elementUser;
    document.querySelector('#newTask_input_observers').innerHTML = elementUser;
    document.querySelector('#newTask_input_auditedBy').innerHTML = elementUser;
    $("#newTask_input_assignedFrom").selectpicker('refresh');
    $("#newTask_input_assignedTo").selectpicker('refresh');
    $("#newTask_input_assignedFrom").selectpicker('refresh');
    $("#newTask_input_participants").selectpicker('refresh');
    $("#newTask_input_observers").selectpicker('refresh');
    $("#newTask_input_auditedBy").selectpicker('refresh');

    //get priority list
    let elementTaskPriority = '&lt;option>&lt;/option>'
    for (let element of preData.priorities) {
        elementTaskPriority += `&lt;option>${element}&lt;/option>`
    }
    document.querySelector('#newTask_input_taskPriority').innerHTML = elementTaskPriority;
    $("#newTask_input_taskPriority").selectpicker('refresh');
};


/**
 * function to clear new task inputs
 * @constructor
 */
function clearNewTaskInputs() {
    document.querySelector('#newTask_form').reset()
    document.querySelectorAll('output').forEach(output => {
        output.innerHTML = '';
    });

    $('.selectpicker').selectpicker('refresh');
    $('.selectpicker').selectpicker('deselectAll');
    document.querySelector('#newTask .subtasksNewTask #subtaskTable tbody').innerHTML = '';
    subTaskArr = [];
};

/**
 * function to clear log progress inputs
 * @constructor
 */
function clearTaskLogProgressInputs() {
    document.querySelectorAll('#logProgress_form input[type="number"] , #logProgress_form input[type="date"] , #logProgress_form textarea').forEach(output => {
        output.value = '';
    });
};

/* ===================================================== subtasks =============================================== */
let subTaskAdd = document.getElementById('subTaskAdd'),
    subtTaskFields = document.getElementById('subtTaskFields'),
    subtaskTable = document.querySelector('#subtaskTable');
subTaskAdd.onclick = function(e) {
    let subTask = {};
    subtTaskFields.querySelectorAll('[id*="subtask_"]').forEach(function(input) {
        let inpName = input.id.split('_')[1];
        subTask[inpName] = input.value.trim();
    });

    if (subTask.name == '' || subTask.hours == '') {
        notifyResult(false, `Can't Add Empty Fields`)
    } else {
        subTaskArr.push(subTask);
        subTaskArr.map(v => Object.assign(v, { "type": "planned" }));

        //============add in table subtask==============
        $(subtaskTable).find('tbody').prepend(`
            &lt;tr id="parentRowSubTask" class="border-top">
                &lt;td>&lt;/td>
                &lt;td>&lt;input data-toggle="tooltip" data-placement ="top" title="${subTask.name.trim()}" class="inputs text-center border-0 bg-transparent form-control p-0" readonly type="text" name="subtask_name" value="${subTask.name.trim()}">&lt;/td>
                &lt;td>&lt;input class="inputs border-0 bg-transparent form-control p-0" readonly type="number" min="0" name="subtask_hours" step="0.01" value="${subTask.hours}">&lt;/td>
                &lt;td>&lt;i class="far fa-times-circle text-danger deleteSubtask">&lt;/i>&lt;/td>
    
            &lt;/tr>`);
        //========= clear inputs after add each subtask added ==============
        subtTaskFields.querySelectorAll('[id*="subtask_"]').forEach(function(input) {
            input.value = '';
        });

        //=============delete subTask remove row and object from array ==============
        let deleteSubtask = document.querySelectorAll('.deleteSubtask');
        deleteSubtask.forEach(subtaskDelete => {
            subtaskDelete.onclick = function(e) {
                let filterSubTasks = subTaskArr.filter(function(ti) {
                    return ti.name != e.path[2].children[1].children[0].value
                });
                subTaskArr = filterSubTasks;
                e.target.parentElement.parentElement.remove();
            };
        });
    }
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="clearNewTaskInputs.html">clearNewTaskInputs</a></li><li><a href="clearTaskLogProgressInputs.html">clearTaskLogProgressInputs</a></li><li><a href="deleteSubTaskS.html">deleteSubTaskS</a></li><li><a href="EditTaskModal.html">EditTaskModal</a></li><li><a href="fillEditTaskForm.html">fillEditTaskForm</a></li><li><a href="fillLogRecordTable.html">fillLogRecordTable</a></li><li><a href="fillNewTaskPreData.html">fillNewTaskPreData</a></li><li><a href="fillOutputsOfTaskView.html">fillOutputsOfTaskView</a></li><li><a href="fillSubTasksList.html">fillSubTasksList</a></li><li><a href="fillTasksListTable.html">fillTasksListTable</a></li><li><a href="fillTasksSettingsPreData.html">fillTasksSettingsPreData</a></li><li><a href="GetFilteredData.html">GetFilteredData</a></li><li><a href="GetFilteredDataLogRecord.html">GetFilteredDataLogRecord</a></li><li><a href="getFilterObject.html">getFilterObject</a></li><li><a href="GETspecificTask.html">GETspecificTask</a></li><li><a href="getTasksIDAndName.html">getTasksIDAndName</a></li><li><a href="loadLogRecordFirstTime.html">loadLogRecordFirstTime</a></li><li><a href="loadTasksFirstTime.html">loadTasksFirstTime</a></li><li><a href="retrieveNewTaskInputs.html">retrieveNewTaskInputs</a></li><li><a href="taskList_specificTask_openModalAddSubTask.onclick.html">onclick</a></li></ul><h3>Global</h3><ul><li><a href="global.html#fillTaskLogProgressData">fillTaskLogProgressData</a></li><li><a href="global.html#retrieveEditTaskInputs">retrieveEditTaskInputs</a></li><li><a href="global.html#retrieveTaskLogProgressInputs">retrieveTaskLogProgressInputs</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Feb 25 2021 16:57:54 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
